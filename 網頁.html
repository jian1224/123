<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>âœ¨ Emoji é­”æ³•æ¢ç´¢å™¨</title>
  <style>
    /* === ä½ çš„ CSS ä¿ç•™ä¸è®Šï¼Œç‚ºç¯€çœç¯‡å¹…ç•¥å» === */
  </style>
</head>
<body>
  <div class="copy-feedback" id="copyFeedback">
    <span id="copyText">âœ¨ å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼</span>
  </div>

  <div class="container">
    <div class="header">
      <h1 class="title">âœ¨ Emoji é­”æ³•æ¢ç´¢å™¨</h1>
      <p class="subtitle">æ¢ç´¢ç„¡é™å¯èƒ½çš„è¡¨æƒ…ä¸–ç•Œï¼Œè®“å°è©±æ›´åŠ ç”Ÿå‹•æœ‰è¶£</p>
    </div>

    <div class="search-section">
      <div class="search-container">
        <input type="text" class="search-input" id="search" placeholder="è¼¸å…¥é—œéµå­—æ¢ç´¢ Emoji ä¸–ç•Œ..." />
        <div class="search-icon">ğŸ”</div>
      </div>

      <div class="controls">
        <button class="btn btn-primary" id="randomBtn" onclick="showRandom()">ğŸ² éš¨æ©Ÿæ¢ç´¢</button>
        <button class="btn btn-secondary" id="searchBtn" onclick="fetchEmoji()">ğŸš€ é–‹å§‹æœå°‹</button>
        <button class="btn btn-secondary" onclick="copyToClipboard()">ğŸ“‹ è¤‡è£½è¡¨æƒ…</button>
      </div>
    </div>

    <div class="emoji-display">
      <div class="emoji-text" id="emojiText">æº–å‚™å¥½æ¢ç´¢ Emoji çš„é­”æ³•ä¸–ç•Œäº†å—ï¼ŸğŸŒŸ</div>
    </div>

    <div class="section">
      <h2 class="section-title">â° æœ€è¿‘ç™¼ç¾çš„å¯¶è—</h2>
      <div class="recent-container" id="recentContainer">
        <div class="empty-state">é‚„æ²’æœ‰æ¢ç´¢éä»»ä½• Emoji å‘¢ï½</div>
      </div>
    </div>

    <div class="keywords-section">
      <h2 class="section-title">ğŸ¯ ç†±é–€é—œéµå­—</h2>
      <div class="keywords-grid" id="keywordsGrid"></div>
    </div>
  </div>

  <script>
    const apiKey = "857cbe3e777e160ec4b944a515e501776b81056f";
    const recent = [];
    const keywordPool = [
      "sad", "angry", "love", "smile", "food", 
      "laugh", "cry", "cool", "sleep", "party", 
      "heart", "star", "fire", "music", 
    ];
    let isLoading = false;

    function showRandom() {
      const randomKeyword = keywordPool[Math.floor(Math.random() * keywordPool.length)];
      document.getElementById("search").value = randomKeyword;
      fetchEmoji();
    }

    function fetchEmoji() {
      if (isLoading) return;
      const keyword = document.getElementById("search").value.trim();
      if (!keyword) {
        showError("è«‹è¼¸å…¥é—œéµå­—ï¼");
        return;
      }

      setLoading(true);
      const url = `https://emoji-api.com/emojis?search=${encodeURIComponent(keyword)}&access_key=${apiKey}`;
      
      fetch(url)
        .then(res => res.json())
        .then(data => {
          console.log("API å›å‚³è³‡æ–™ï¼š", data);

          // åŠ å…¥éŒ¯èª¤è³‡æ–™åˆ¤æ–·
          if (!Array.isArray(data)) {
            if (data.status === 'error' && data.message) {
              showError(`ğŸ˜• ${data.message}ï¼Œè«‹æ›å€‹é—œéµå­—è©¦è©¦ï¼`);
            } else {
              showError("â— ç„¡æ³•è§£æ API å›å‚³çµæœ");
            }
            return;
          }

          const emojis = data.filter(item => item.character);
          if (emojis.length > 0) {
            const result = emojis[Math.floor(Math.random() * emojis.length)].character;
            updateEmojiDisplay(result);
            addToRecent(result);
          } else {
            showError("ğŸ˜• æ‰¾ä¸åˆ°ç›¸é—œçš„ Emojiï¼Œè©¦è©¦å…¶ä»–é—œéµå­—å§ï¼");
          }
        })
        .catch(err => {
          console.error("API éŒ¯èª¤ï¼š", err);
          showError("ğŸš« ç¶²è·¯é€£æ¥å‡ºç¾å•é¡Œï¼Œè«‹ç¨å¾Œå†è©¦");
        })
        .finally(() => {
          setLoading(false);
        });
    }

    function updateEmojiDisplay(emoji) {
      const emojiText = document.getElementById("emojiText");
      emojiText.textContent = emoji;
      emojiText.classList.remove('bounce');
      setTimeout(() => {
        emojiText.classList.add('bounce');
      }, 10);
    }

    function showError(message) {
      const emojiText = document.getElementById("emojiText");
      emojiText.textContent = message;
      emojiText.classList.remove('bounce');
      setTimeout(() => {
        emojiText.classList.add('bounce');
      }, 10);
    }

    function setLoading(loading) {
      isLoading = loading;
      const searchBtn = document.getElementById("searchBtn");
      const randomBtn = document.getElementById("randomBtn");

      if (loading) {
        searchBtn.classList.add('loading');
        randomBtn.classList.add('loading');
        searchBtn.textContent = '';
        randomBtn.textContent = '';
      } else {
        searchBtn.classList.remove('loading');
        randomBtn.classList.remove('loading');
        searchBtn.innerHTML = 'ğŸš€ é–‹å§‹æœå°‹';
        randomBtn.innerHTML = 'ğŸ² éš¨æ©Ÿæ¢ç´¢';
      }
    }

    function copyToClipboard() {
      const text = document.getElementById("emojiText").textContent;
      if (text && !text.includes("æ‰¾ä¸åˆ°") && !text.includes("ç¶²è·¯é€£æ¥") && !text.includes("æº–å‚™å¥½æ¢ç´¢")) {
        navigator.clipboard.writeText(text).then(() => {
          showCopyFeedback(text);
        }).catch(() => {
          const textArea = document.createElement('textarea');
          textArea.value = text;
          document.body.appendChild(textArea);
          textArea.select();
          document.execCommand('copy');
          document.body.removeChild(textArea);
          showCopyFeedback(text);
        });
      }
    }

    function showCopyFeedback(emoji) {
      const feedback = document.getElementById("copyFeedback");
      const copyText = document.getElementById("copyText");
      copyText.textContent = `âœ¨ å·²è¤‡è£½ ${emoji} åˆ°å‰ªè²¼ç°¿ï¼`;
      feedback.classList.add("show");
      setTimeout(() => {
        feedback.classList.remove("show");
      }, 3000);
    }

    function addToRecent(emoji) {
      if (recent.includes(emoji)) {
        recent.splice(recent.indexOf(emoji), 1);
      }
      recent.unshift(emoji);
      if (recent.length > 8) recent.pop();
      updateRecentDisplay();
    }

    function updateRecentDisplay() {
      const container = document.getElementById("recentContainer");
      if (recent.length === 0) {
        container.innerHTML = '<div class="empty-state">é‚„æ²’æœ‰æ¢ç´¢éä»»ä½• Emoji å‘¢ï½</div>';
      } else {
        container.innerHTML = recent.map(emoji => 
          `<div class="recent-item" onclick="selectRecentEmoji('${emoji}')" title="é»æ“Šé‡æ–°é¸æ“‡">${emoji}</div>`
        ).join('');
      }
    }

    function selectRecentEmoji(emoji) {
      updateEmojiDisplay(emoji);
    }

    function searchKeyword(keyword) {
      document.getElementById("search").value = keyword;
      fetchEmoji();
    }

    function createKeywordsGrid() {
      const keywordsGrid = document.getElementById("keywordsGrid");
      keywordsGrid.innerHTML = keywordPool.map(keyword => 
        `<div class="keyword-tag" onclick="searchKeyword('${keyword}')">${keyword}</div>`
      ).join('');
    }

    // åˆå§‹åŒ–
    document.getElementById("search").addEventListener('keydown', function(event) {
      if (event.key === 'Enter') {
        fetchEmoji();
      }
    });

    document.addEventListener('keydown', function(event) {
      if (event.key === ' ' && document.activeElement.tagName !== 'INPUT') {
        event.preventDefault();
        showRandom();
      } else if (event.ctrlKey && event.key === 'c') {
        copyToClipboard();
      }
    });

    document.addEventListener('DOMContentLoaded', function() {
      createKeywordsGrid();
      updateRecentDisplay();
    });
  </script>
</body>
</html>
